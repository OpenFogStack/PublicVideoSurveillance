# Log Management

There are two logging databases, each one a DynamoDB with a fixed schema:

User Action Database:  
`Id` | `UserId` | `Action` | `ResourceId` | `ResourceType` | `AdditionalInfoObject` | `Signature` | `Hash` | `Link` | `Timestamp`

System Database schema:  
`Id` | `ComponentId` | `ComponentType` | `Action` | `AdditionalInfoObject` | `Level` | `Hash` | `Link` | `Timestamp`

`ID` is always a unique ID for the log, generated by `uuidv1`.  
`Hash` is a SHA512 hash of the previous log entry, available through the attribute `Link`.  
`Timestamp` is a timestamp of when the log entry was created.  
The `AdditionalInfoObject` is a flexible map object.

The user action database also contains the `UserId`, `Action` (use the `LOG_ACTIONS` in `constants.js` for this), the `ResourceId` and `ResourceType` (use the `RESOURCE_TYPES` in `constants.js` for this). The `Signature` attribute is currently not used but reserved for future use.

The system database contains the attributes `ComponentId` (this may, for example, be used for different edges), the `ComponentType` (use the `COMPONENT_TYPES` in `constants.js` for this), `Action` (use the `LOG_SYSTEM_ACTIONS` in `constants.js` for this) and the `Level`, which determines the log level (use the `LOG_LEVEL` in `constants.js` for this, more on this below).

The hash is calculated by hashing to complete log entry object as returned by DynamoDB.

## How to add the log management into your lambda-function:

You need a few lines of code to enable logging:

```javascript
const {
  createUserActionLogEntry,
  createSystemActionLogEntry
} = require("../secure-log-api/log-manager");

const { LOG_ACTIONS, RESOURCE_TYPES } = require("../../constants");

//Your awesome code ...
//...

createUserActionLogEntry({
  UserId: "abcd123",
  Action: LOG_ACTIONS.USER_UPDATE,
  ResourceId: "cdef123",
  ResourceType: RESOURCE_TYPES.USER,
  AdditionalInfoObject: {
    name: "test",
    description: "test"
  }
});
```

## Log Level

At the moment, there are a few different log levels that make debugging and auditing easier. They are:

1.  `DEBUG` - log entries needed to debug the system
1.  `VERBOSE` - verbose information about what the system does
1.  `IMPORTANT` - important information about what happens in the system (e.g. if an edge recognizes a face)
1.  `WARNING` - recoverable warnings in the systems (e.g. if something minor went wrong)
1.  `ERROR` - irrecoverable errors in the systems
1.  `CRITICAL_ERROR` - extremely fatal errors
